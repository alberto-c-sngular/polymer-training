<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="user-card.html">
<link rel="import" href="new-user-form.html">
<link rel="import" href="redux/redux-mixin.html">

<dom-module id="user-list">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }
      .noUsers {
        text-align: center;
        font-style: italic;
        color: var(--secondary-text-color);
      }
    </style>
    <new-user-form class="centered" on-add-user="_addUser"></new-user-form>
    <hr>
    <template is="dom-if" if="[[noUsers]]">
      <p class="noUsers">La lista de usuarios está vacía.</p>  
    </template>   
    <template is="dom-repeat" items="[[users]]" as="user">
      <user-card user="[[user]]" on-remove-user="_removeUser"></user-card>
    </template>
    <template is="dom-if" if="[[!noUsers]]">
      <hr>    
      <b>Media edad: </b> [[mediaEdad]]
    </template>
  </template>

  <script>
    /**
     * `user-list`
     * Lista de usuarios
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class UserList extends ReduxMixin(Polymer.Element) {
      static get is() { return 'user-list'; }
      static get properties() {
        return {
          users: {
            type: Array,
            statePath: 'users'
          },
          mediaEdad: {
            type: Number,
            computed: '_mediaEdad(users.splices)'
          },
          noUsers: {
            type: Boolean,
            computed: '_haveUsers(users.splices)'
          }
        };
      }
      static get actions() {
        return {
          remove: user => {
            return { type: 'REMOVE_USER', user: user }
          },
          addUser: user => { 
            return { type: 'ADD_USER', user: user }
          },
          setUsers: users => { 
            return { type: 'SET_USERS', users: users }
          },
          reset: user => { 
            return { type: 'RESET' }
          },
        }
      }

      _mediaEdad() {
        return ~~this.users
          .reduce( (total, actual) => total + actual.edad, 0) / this.users.length || 0;
      }

      _haveUsers() {
        return !this.users.length;
      }

      _addUser(evt) {
        const userToAdd = evt.detail;
        this.dispatch('addUser', userToAdd);
      }

      _removeUser(evt) {
        const userToRemove = evt.detail;
        this.dispatch('remove', userToRemove);
      }
    }

    window.customElements.define(UserList.is, UserList);
  </script>
</dom-module>
