<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="user-card.html">
<link rel="import" href="new-user-form.html">

<dom-module id="user-list">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }
    </style>
    <h3>AÃ±adir usuario</h3>
    <new-user-form on-add-user="_addUser"></new-user-form>
    <hr>    
    <template is="dom-repeat" items="[[users]]" as="user">
      <user-card user="[[user]]" on-remove-user="_removeUser"></user-card>
    </template>
    <hr>
    <b>Media edad: </b> [[mediaEdad]]
  </template>

  <script>
    /**
     * `user-list`
     * Lista de usuarios
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class UserList extends Polymer.Element {
      static get is() { return 'user-list'; }
      static get properties() {
        return {
          users: {
            type: Array,
            value: () => []
          },
          mediaEdad: {
            type: Number,
            computed: '_mediaEdad(users.splices)'
          }
        };
      }
      constructor() {
        super();
        this.contador = 0;
      }

      _mediaEdad() {
        return ~~this.users
          .reduce( (total, actual) => total + actual.edad, 0) / this.users.length || 0;
      }

      _addUser(evt) {
        this.push('users', {
          id: this.contador++,
          ...evt.detail
        });
      }

      _removeUser(evt) {
        const userToRemove = evt.detail;
        this.set('users',
          this.users.filter(
            user => user.id !== userToRemove.id
          )
        );
      }
    }

    window.customElements.define(UserList.is, UserList);
  </script>
</dom-module>
