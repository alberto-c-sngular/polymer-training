<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>list-component test</title>

    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
    <link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
    <link rel="import" href="../list-component.html">
  </head>
  <body>

    <test-fixture id="list-component-fixture">
      <template>
        <list-component></list-component>
      </template>
    </test-fixture>

    <script>

      suite('list-component', () => {
        let element, shadowRoot;
        
        setup(function() {
          element = fixture('list-component-fixture');
          shadowRoot = element.shadowRoot;
        });

        test('There is an initial user John Doe.', (done) => { 
          flush(function() {
            const rows = shadowRoot.querySelectorAll('tr');
            // Header + John Doe + new user row (input)
            assert.equal(rows.length, 3);
            done();
          });
        });

        test('Adding a new user increases the users array.', () => {
          element.newName = 'Bruce';
          element.newSurname = 'Wayne';
          element.newAge = '45';
          const initialUsers = element.users.length;
          element.addUser();
          const finalUsers = element.users.length;
          assert.equal(initialUsers + 1, finalUsers);
        });

        test('Background color depends on age', (done) => {
          // Child
          element.newName = 'Kid';
          element.newSurname = 'Flash';
          element.newAge = '15';
          element.addUser();

          flush(function() {
            const rows = shadowRoot.querySelectorAll('tr');
            assert.equal(rows[2].classList.contains('child'), true);
            done();
          });
        });

      });
    </script>

  </body>
</html>
