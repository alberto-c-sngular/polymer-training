<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="list-component">
  <template>
    <!-- list-component styles -->
    <style>
      :host {
        display: block;
      }
      .child {
        background-color: #FFF;
      }
      .young {
        background-color: #EFF7F7;
      }
      .mature {
        background-color: #CBF2F2;
      }
      .senior {
        background-color: #88EFEF;
      }
      #add-user {
        cursor: pointer;
      }
    </style>
    
    <!-- list-component DOM -->
    <table>
      <tr>
        <th>Nombre</th>
        <th>Primer Apellido</th>
        <th>Edad</th>
      </tr>
      <!-- Repeat for each user -->
      <template is="dom-repeat" items="{{users}}">
        <tr class$="[[computeColor(item)]]">
          <td>[[item.name]]</td>
          <td>[[item.surname]]</td>
          <td>[[item.age]]</td>
        </tr>
      </template>
      <!-- Add new user -->
      <tr>
        <td><input type="text" name="name" id="input-name" value="{{newName::change}}"></td>
        <td><input type="text" name="surname" id="input-surname" value="{{newSurname::change}}"></td>
        <td>
          <input 
            type="number" 
            name="age" 
            id="input-age" 
            value="{{newAge::change}}"
            min="0">
        </td>
        <td><button id="add-user" on-click="addUser">Add User</button></td>
      </tr>
    </table>
    <!-- Users average age -->
    <p>Average Age: [[average]]</p>
  </template>

  <script>
    /**
     * `list-component`
     * List component Polymer 2.x training
     *
     * @customElement
     * @polymer
     * @demo index.html
     */
    class ListComponent extends Polymer.Element {
      
      static get is() { return 'list-component'; }
      
      static get properties() {
        return {
          /**
           * Users information
           * 
           * @type: [{name: string, surname: string, age: number}]
           */
          users: {
            type: Array,
            value: function() {
              return [
                {
                  name: 'John',
                  surname: 'Doe',
                  age: 30
                }
              ];
            }
          },
          /** Average age of all users */
          average: {
            type: Number,
            computed: 'computeAverage(users.splices)'
          },
          /** Name of the new user */
          newName: {
            type: String,
            value: ''
          },
          /** Surname of the new user */
          newSurname: {
            type: String,
            value: ''
          },
          /** Age of the new user */
          newAge: {
            type: Number,
            value: 0
          }
        };
      }

      /**
       * Compute average age value
       *
       * @return {number} The average age of all users.
       */
      computeAverage() {
        let result = 0;
        this.users.forEach(u => {
          result += parseInt(u.age);  
        });
        return (result / this.users.length).toFixed(0);
      }

      /**
       * User background color depending on age
       * @return {string} The class name for the table row
       */
      computeColor(item) {
        if(item.age < 20) {
          return 'child';
        } else if(item.age < 30) {
          return 'young';
        } else if(item.age < 40) {
          return 'mature';
        } else {
          return 'senior';
        }
      }

      /**
       * Add users from inputs
       */
      addUser() {
        if(this.newName && this.newSurname && (parseInt(this.newAge) >= 0)) {
          this.push('users', {
            name: this.newName,
            surname: this.newSurname,
            age: parseInt(this.newAge)
          });
        }
      }

    }

    window.customElements.define(ListComponent.is, ListComponent);
  </script>
</dom-module>
